<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <title>Mahara í…œí”Œë¦¿ ì„ íƒ</title>
  <link rel="stylesheet" href="style.css" />
  <!-- ë°ì´í„° ë¨¼ì € ë¡œë“œ -->
  <script src="data.js"></script>
</head>
<body>
  <!-- ğŸ”” í† ìŠ¤íŠ¸ -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- ğŸŒ™ ë‹¤í¬ëª¨ë“œ ìŠ¤ìœ„ì¹˜ -->
  <button id="theme-toggle" class="action-pill" type="button" title="ë‹¤í¬ëª¨ë“œ ì „í™˜">ğŸŒ™</button>

  <!-- â¬†ï¸ ë§¨ ìœ„ë¡œ ë²„íŠ¼ -->
  <button id="backToTop" class="back-to-top" type="button" aria-label="ë§¨ ìœ„ë¡œ">â†‘</button>

  <header class="topbar">
    <h1>Mahara í…œí”Œë¦¿ ì„ íƒ</h1>
    <p class="subtitle">í•„ìš”í•œ í…œí”Œë¦¿ì„ ì„ íƒí•˜ê³  Maharaì—ì„œ ì´ì–´ì„œ ì‘ì„±í•˜ì„¸ìš”.</p>
  </header>

  <main class="container">
    <section class="template-area">
      <!-- í•„í„°ë°” -->
      <div class="filter-bar" id="filter-bar">
        <button class="filter-btn active" data-filter="all">ì „ì²´</button>
        <button class="filter-btn" data-filter="ê¸°ì´ˆ">ê¸°ì´ˆ</button>
        <button class="filter-btn" data-filter="ì„ìƒ">ì„ìƒ</button>
        <button class="filter-btn" data-filter="ì„ìƒì‹¤ìŠµ">ì„ìƒì‹¤ìŠµ</button>
        <button class="filter-btn" data-filter="ì¡¸ì—…">ì¡¸ì—…</button>
      </div>

      <!-- í…œí”Œë¦¿ ëª©ë¡ -->
      <section class="template-list" id="template-list"></section>
    </section>

    <aside class="guide-panel">
      <h2>êµìˆ˜ììš© ì•ˆë‚´</h2>
      <div id="guide-content">í…œí”Œë¦¿ì„ ì„ íƒí•˜ë©´ ì´ê³³ì— êµìˆ˜ììš© ì•ˆë‚´ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
    </aside>
  </main>

  <footer class="footer">
    <small>â€» ì´ í˜ì´ì§€ëŠ” Maharaë¥¼ ëŒ€ì‹ í•´ì„œ ì €ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í…œí”Œë¦¿ ì„ íƒ í›„ Maharaì—ì„œ ë§ˆë¬´ë¦¬í•˜ì„¸ìš”.</small>
  </footer>

  <script>
    // ============= ì•ˆì „ì¥ì¹˜: data.js í™•ì¸ =============
    if (typeof templates === "undefined" || typeof teacherGuides === "undefined") {
      document.getElementById("template-list").innerHTML =
        '<p style="color:red;font-weight:600">data.jsë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. íŒŒì¼ ì´ë¦„/ìœ„ì¹˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>';
      throw new Error("data.js not loaded");
    }

    // ---------------------------
    // ğŸ§© í™”ë©´ ë¡œì§
    // ---------------------------
    const listBox = document.getElementById("template-list");
    const guideContent = document.getElementById("guide-content");
    const filterBar = document.getElementById("filter-bar");
    const toast = document.getElementById("toast");
    const themeToggle = document.getElementById("theme-toggle");
    const backToTop = document.getElementById("backToTop");

    let currentFilter = "all";

    // ğŸ”” í† ìŠ¤íŠ¸
    function showToast(message) {
      toast.textContent = message;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 2000);
    }

    // ì™¸ë¶€ ì´ë™
    function openExternal(url) {
      showToast("í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œë¥¼ ìœ„í•œ ê·¸ë£¹ê°€ì… êµ¬ê¸€í¼ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤");
      window.open(url, "_blank");
    }

    // ë Œë”
    function renderTemplates() {
      listBox.innerHTML = "";
      const filtered = templates.filter(t => currentFilter === "all" ? true : t.category === currentFilter);

      if (filtered.length === 0) {
        listBox.innerHTML = `<p style="color:#6b7280; font-size:0.8rem;">í•´ë‹¹ ì¡°ê±´ì˜ í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
        return;
      }

      filtered.forEach(t => {
        const card = document.createElement("article");
        card.className = "template-card";
        const icon = (typeof categoryIcons !== "undefined" && categoryIcons[t.category]) ? categoryIcons[t.category] : "ğŸ“";

        card.innerHTML = `
          <div class="template-header">
            <div class="title-wrap">
              <span class="icon-pill">${icon}</span>
              <h3>${t.name}</h3>
            </div>
            ${t.badge ? `<span class="badge">${t.badge}</span>` : ""}
          </div>
          <p class="target"><strong>ëŒ€ìƒ:</strong> ${t.target}</p>
          <p class="desc">${t.desc}</p>
          <div class="actions">
            <button class="primary" onclick="openExternal('${t.maharaUrl}')">Maharaì—ì„œ ì—´ê¸°</button>
            <button class="secondary" onclick="showTeacherGuide('${t.id}')">êµìˆ˜ììš© ì•ˆë‚´ ë³´ê¸°</button>
          </div>
        `;
        listBox.appendChild(card);
      });
    }

    // ì•ˆë‚´ í‘œì‹œ
    function showTeacherGuide(id) {
      const guideText = teacherGuides[id];
      guideContent.innerHTML = guideText || "ì´ í…œí”Œë¦¿ì—ëŠ” êµìˆ˜ììš© ì•ˆë‚´ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.";
    }

    // í•„í„°
    filterBar.addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;
      currentFilter = btn.dataset.filter;
      document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      renderTemplates();
    });

    // ğŸŒ™ ë‹¤í¬ëª¨ë“œ: ì €ì¥/ì ìš©
    const root = document.documentElement;
    function applyTheme(theme) {
      root.setAttribute("data-theme", theme);
      // ë²„íŠ¼ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
      themeToggle.textContent = theme === "dark" ? "â˜€ï¸" : "ğŸŒ™";
      localStorage.setItem("theme", theme);
    }
    // ì´ˆê¹ƒê°’: localStorage â†’ ì‹œìŠ¤í…œ
    (function initTheme(){
      const saved = localStorage.getItem("theme");
      if (saved === "light" || saved === "dark") {
        applyTheme(saved);
      } else {
        const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
        applyTheme(prefersDark ? "dark" : "light");
      }
    })();
    // í† ê¸€
    themeToggle.addEventListener("click", () => {
      const next = root.getAttribute("data-theme") === "dark" ? "light" : "dark";
      applyTheme(next);
    });

    // â¬†ï¸ ë§¨ ìœ„ë¡œ ë²„íŠ¼
    window.addEventListener("scroll", () => {
      if (window.scrollY > 300) {
        backToTop.classList.add("show");
      } else {
        backToTop.classList.remove("show");
      }
    });
    backToTop.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
    });

    // ì´ˆê¸° ë Œë” + ê¸°ë³¸ ì•ˆë‚´
    renderTemplates();
    const first = templates[0];
    if (first && teacherGuides[first.id]) guideContent.innerHTML = teacherGuides[first.id];
  </script>
</body>
</html>
